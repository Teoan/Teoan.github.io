<!doctype html><html lang=zh-cn data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.108.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-32.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-96.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-120.png><meta itemprop=name content="记录一下SpringSecurity的使用过程"><meta itemprop=description content="保持对技术的热爱"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://teoan.github.io/imgs/profile_20180304_000045_1.png"><meta itemprop=keywords content="SpringSecurity"><meta property="og:type" content="article"><meta property="og:title" content="记录一下SpringSecurity的使用过程"><meta property="og:description" content="保持对技术的热爱"><meta property="og:image" content="/imgs/profile_20180304_000045_1.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://teoan.github.io/post/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bspringsecurity%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/"><meta property="og:site_name" content="Teoan's Notes"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Teoan"><meta property="article:published_time" content="2020-05-10 11:14:07 +0000 UTC"><meta property="article:modified_time" content="2020-05-10 11:14:07 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.8dfa56c63ced9d8fef37c21ecb7cbc0dcac8c2862affd6eacfb5ea8ae5fb775c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bspringsecurity%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B","permalink":"https://teoan.github.io/post/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bspringsecurity%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/","title":"记录一下SpringSecurity的使用过程","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>记录一下SpringSecurity的使用过程 - Teoan's Notes</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Teoan's Notes</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>积一时之跬步 臻千里之遥程</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>16</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#写在前面>写在前面</a></li><li><a href=#什么是springsecurity>什么是SpringSecurity？</a></li><li><a href=#如何在springboot中使用springsecurity>如何在SpringBoot中使用SpringSecurity？</a><ul><li><a href=#引入依赖>引入依赖</a></li><li><a href=#配置spring-security>配置Spring Security</a><ul><li><a href=#认证管理器配置方法>认证管理器配置方法</a></li><li><a href=#核心过滤器配置方法>核心过滤器配置方法</a></li><li><a href=#安全过滤器链配置方法>安全过滤器链配置方法。</a></li></ul></li></ul></li><li><a href=#最后>最后</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Teoan src=/imgs/img-lazy-loading.gif data-src=/imgs/profile_20180304_000045_1.png><p class=site-author-name itemprop=name>Teoan</p><div class=site-description itemprop=description>保持对技术的热爱</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>16</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>2</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>22</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/Teoan title="Github → https://github.com/Teoan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=mailto:d277077411@gmail.com title="E-Mail → mailto:d277077411@gmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2018-08-28T11:27:03+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=29017></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=68></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-06-23T19:35:40+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/Teoan rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://teoan.github.io/post/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bspringsecurity%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/profile_20180304_000045_1.png"><meta itemprop=name content="Teoan"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Teoan"><meta itemprop=description content="保持对技术的热爱"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="记录一下SpringSecurity的使用过程"><meta itemprop=description content="写在前面
在学习项目的过程中，发现权限认证管理使用的是SpringSecurity，SpringSecurity功能非常强大，由于之前没接触过，所以此写下自己的入门使用过程。"></span><header class=post-header><h1 class=post-title itemprop="name headline">记录一下SpringSecurity的使用过程</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2020-05-10 11:14:07 +0000 UTC" itemprop="dateCreated datePublished" datetime="2020-05-10 11:14:07 +0000 UTC">2020-05-10</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%8A%80%E6%9C%AF itemprop=url rel=index><span itemprop=name>技术</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>2084</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>5分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/post/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bspringsecurity%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=写在前面>写在前面</h2><p>在学习项目的过程中，发现权限认证管理使用的是SpringSecurity，SpringSecurity功能非常强大，由于之前没接触过，所以此写下自己的入门使用过程。</p><h2 id=什么是springsecurity>什么是SpringSecurity？</h2><p>Spring Security是一套认证授权框架,支持认证模式如HTTP BASIC 认证头 (基于 IETF RFC-based 标准),HTTP Digest 认证头 ( IETF RFC-based 标准),Form-based authentication (用于简单的用户界面),OpenID 认证等,Spring Security使得当前系统可以快速集成这些验证机制亦或是实现自己的一套验证机制.</p><h2 id=如何在springboot中使用springsecurity>如何在SpringBoot中使用SpringSecurity？</h2><h3 id=引入依赖>引入依赖</h3><ol><li>在创建项目的时候引入依赖。
<img src=/imgs/img-lazy-loading.gif data-src=https://i.imgur.com/wdJi5Nr.jpg alt></li><li>直接在pom.xml中引入依赖。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>            <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-security<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>引入依赖后Spring Security默认保护所有接口。</p><h3 id=配置spring-security>配置Spring Security</h3><p>Spring Security提供了一个适配器，可以在适配器的实现类中去配置Spring Security，包括认证方式、登录成功失败后跳转的页面、API接口的拦截与放行等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSecurityConfig</span>  <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>AuthenticationManagerBuilder auth<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>WebSecurity web<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>    
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>WebSecurityConfigurerAdapter提供了三个configure函数需要我们去实现。</p><h4 id=认证管理器配置方法>认证管理器配置方法</h4><p>主要配置用户的认证、加密方式等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>AuthenticationManagerBuilder auth<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//自定义的用户和角色数据提供者
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        auth<span style=color:#f92672>.</span><span style=color:#a6e22e>userDetailsService</span><span style=color:#f92672>(</span>customUserDetailsService<span style=color:#f92672>).</span><span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> PasswordEncoder<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> <span style=color:#75715e>//设置密码加密对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//encode():把参数按照特定的解析规则进行解析
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>encode</span><span style=color:#f92672>(</span>CharSequence charSequence<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                使用Spring自带的加密工具加密字段
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>return</span> DigestUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>md5DigestAsHex</span><span style=color:#f92672>(</span>charSequence<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//            matches()验证从存储中获取的编码密码与编码后提交的原始密码是否匹配
</span></span></span><span style=display:flex><span><span style=color:#75715e>//            第一个参数表示需要被解析的密码。第二个参数表示存储的密码。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>matches</span><span style=color:#f92672>(</span>CharSequence charSequence<span style=color:#f92672>,</span> String s<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>DigestUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>md5DigestAsHex</span><span style=color:#f92672>(</span>charSequence<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getBytes</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>由于项目中使用的用户名和密码是从数据库中获取的，所以我这里使用了一个自定义的用户和角色数据提供者customUserDetailsService。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomUserDetailsService</span> <span style=color:#66d9ef>implements</span> UserDetailsService <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    UserService userService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    RolesService rolesService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span><span style=color:#f92672>(</span>String s<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> UsernameNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        User user<span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>loadUserByUsername</span><span style=color:#f92672>(</span>s<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>user<span style=color:#f92672>==</span><span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Role<span style=color:#f92672>&gt;</span> roles <span style=color:#f92672>=</span> rolesService<span style=color:#f92672>.</span><span style=color:#a6e22e>getRoleByUid</span><span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setRoles</span><span style=color:#f92672>(</span>roles<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>自定义的用户和角色数据提供者需要实现UserDetailsService接口，这个接口很简单，只需要实现一个函数loadUserByUsername，这个函数需要我们自定义内容，实现通过用户名获取到一个UserDetails的实例对象。UserDetails也是一个接口，我用User对象去实现了UserDetails接口，所以我这里返回的是一个User对象。
下面是UserDetails的源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserDetails</span> <span style=color:#66d9ef>extends</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//返回用户的权限集， 默认需要添加ROLE_ 前缀
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> GrantedAuthority<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAuthorities</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取用户密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    String <span style=color:#a6e22e>getPassword</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取用户名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    String <span style=color:#a6e22e>getUsername</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//账户是否不过期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonExpired</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//账户是否不锁定
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonLocked</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//账户凭证是否不过期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isCredentialsNonExpired</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//账户是否启用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isEnabled</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>UserDetails接口需要我们实现7个函数。函数的作用我已经备注好了。</p><h4 id=核心过滤器配置方法>核心过滤器配置方法</h4><p>一般用来设置忽略Spring Security 对静态资源的控制。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>WebSecurity web<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//忽略对静态资源的控制
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        web<span style=color:#f92672>.</span><span style=color:#a6e22e>ignoring</span><span style=color:#f92672>().</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/blogimg/**&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;/index.html&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;favicon.ico&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;/static/**&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=安全过滤器链配置方法>安全过滤器链配置方法。</h4><p>这个方法比较重要也是使用最多的，HttpSecurity中需要我们配置很多东西，我们可以在HttpSecurity中自定义我们安全访问的规则。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            http<span style=color:#f92672>.</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/admin/category/all&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/admin/**&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;/reg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>hasRole</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;超级管理员&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>///admin/**和/reg的URL都需要有超级管理员角色，如果使用.hasAuthority()方法来配置，需要在参数中加上ROLE_,如下.hasAuthority(&#34;ROLE_超级管理员&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>anyRequest</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span><span style=color:#75715e>//其他的路径都是登录后即可访问
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>formLogin</span><span style=color:#f92672>()</span><span style=color:#75715e>//指定支持基于表单的身份验证。如果未指定FormLoginConfigurer#loginPage(String)，则将生成默认登录页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>loginPage</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login_page&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置登录页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>failureUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login_error&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置登录失败后跳转的页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>defaultSuccessUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login_success&#34;</span><span style=color:#f92672>,</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置登录成功后跳转的页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>loginProcessingUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置登录表单提交的页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>usernameParameter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置表单提交用户名时使用的参数名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>passwordParameter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;password&#34;</span><span style=color:#f92672>)</span><span style=color:#75715e>//设置表单提交密码时使用的参数名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span><span style=color:#75715e>//允许任何人访问
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>logout</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>exceptionHandling</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>accessDeniedHandler</span><span style=color:#f92672>((</span>httpServletRequest<span style=color:#f92672>,</span> httpServletResponse<span style=color:#f92672>,</span> e<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    httpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>setStatus</span><span style=color:#f92672>(</span>HttpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>SC_FORBIDDEN</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    httpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>setContentType</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application/json;charset=utf-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    PrintWriter printWriter <span style=color:#f92672>=</span> httpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    printWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;权限不足，请联系管理员&#34;</span><span style=color:#f92672>);</span><span style=color:#75715e>//返回失败json数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    printWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    printWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=最后>最后</h2><p>SpringSecurity的基础使用就配置完了，可以根据项目需求，选择返回的是一个页面还是返回Json数据。SpringSecurity功能比较强大，貌似配置也比较麻烦一点？等有空我学了另一个安全管理框架&ndash;Shiro再来做个对比。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/springsecurity>SpringSecurity</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E5%85%B3%E4%BA%8Emaven%E7%9A%84%E5%A4%9A%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86/ rel=next title=关于Maven的多模块管理><i class="fa fa-chevron-left"></i> 关于Maven的多模块管理</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E5%85%B3%E4%BA%8Espring-security-%E8%A1%A8%E5%8D%95%E7%99%BB%E5%BD%95%E5%8F%82%E6%95%B0%E4%B8%BAnul%E9%97%AE%E9%A2%98/ rel=prev title="关于spring-security 表单登录参数为null问题">关于spring-security 表单登录参数为null问题
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-paper-plane"></i></span>
<span class=author itemprop=copyrightHolder>Teoan</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://teoan.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.5207e106e9f92dcba41e11e145b3dea597901a731ea853825859c3c82c35adf6.js defer></script></body></html>