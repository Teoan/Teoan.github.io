<!doctype html><html lang=zh-cn data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.108.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-32.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-96.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-120.png><meta itemprop=name content="MapStruct对象映射工具的使用"><meta itemprop=description content="保持对技术的热爱"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://teoan.github.io/imgs/profile_20180304_000045_1.png"><meta itemprop=keywords content="MapStruct"><meta property="og:type" content="article"><meta property="og:title" content="MapStruct对象映射工具的使用"><meta property="og:description" content="保持对技术的热爱"><meta property="og:image" content="/imgs/profile_20180304_000045_1.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://teoan.github.io/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="Teoan's Notes"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Teoan"><meta property="article:published_time" content="2023-03-25 17:15:55 +0000 UTC"><meta property="article:modified_time" content="2023-03-25 17:15:55 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.8dfa56c63ced9d8fef37c21ecb7cbc0dcac8c2862affd6eacfb5ea8ae5fb775c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8","permalink":"https://teoan.github.io/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/","title":"MapStruct对象映射工具的使用","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>MapStruct对象映射工具的使用 - Teoan's Notes</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Teoan's Notes</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>积一时之跬步 臻千里之遥程</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>15</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#官网地址>官网地址</a></li><li><a href=#介绍>介绍</a></li><li><a href=#为什么要用mapstruct>为什么要用MapStruct</a></li><li><a href=#使用>使用</a><ul><li><a href=#引入相关依赖>引入相关依赖</a><ul><li><a href=#maven>Maven</a></li><li><a href=#gradle>Gradle</a></li><li><a href=#mapstruct整合lombok>MapStruct整合Lombok</a></li></ul></li><li><a href=#开始使用>开始使用</a><ul><li><a href=#创建需要映射的实体类>创建需要映射的实体类</a></li><li><a href=#创建mapper映射>创建Mapper映射</a></li></ul></li><li><a href=#自定义字段间映射>自定义字段间映射</a><ul><li><a href=#字段名不同>字段名不同</a></li><li><a href=#多个数据源>多个数据源</a></li><li><a href=#子对象与子对象间的映射>子对象与子对象间的映射</a></li><li><a href=#基本类型的隐式转换和字符串的格式化>基本类型的隐式转换和字符串的格式化</a></li><li><a href=#自定义映射前和映射后的处理>自定义映射前和映射后的处理</a></li><li><a href=#将map映射到bean>将Map映射到Bean</a></li></ul></li><li><a href=#简单分析下原理>简单分析下原理</a><ul><li><a href=#注解处理器annotation-processor-tool>注解处理器(Annotation Processor Tool)</a></li></ul></li><li><a href=#总结>总结</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Teoan src=/imgs/img-lazy-loading.gif data-src=/imgs/profile_20180304_000045_1.png><p class=site-author-name itemprop=name>Teoan</p><div class=site-description itemprop=description>保持对技术的热爱</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>2</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>21</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/Teoan title="Github → https://github.com/Teoan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=mailto:d277077411@gmail.com title="E-Mail → mailto:d277077411@gmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2018-08-28T11:27:03+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=22773></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=55></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-03-25T17:15:55+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/Teoan rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://teoan.github.io/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/profile_20180304_000045_1.png"><meta itemprop=name content="Teoan"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Teoan"><meta itemprop=description content="保持对技术的热爱"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="MapStruct对象映射工具的使用"><meta itemprop=description content="官网地址 MapStruct官网 MapStruct官方文档 介绍 MapStruct是一个对象转换映射工具，用来不同类型责则对象间的转换，如DO、"></span><header class=post-header><h1 class=post-title itemprop="name headline">MapStruct对象映射工具的使用</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2023-03-25 17:15:55 +0000 UTC" itemprop="dateCreated datePublished" datetime="2023-03-25 17:15:55 +0000 UTC">2023-03-25</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%8A%80%E6%9C%AF itemprop=url rel=index><span itemprop=name>技术</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>5501</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>11分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=官网地址>官网地址</h2><p><a href=https://mapstruct.org/ title=MapStruct官网 rel="noopener external nofollow noreferrer" target=_blank class=exturl>MapStruct官网
<i class="fa fa-external-link-alt"></i></a>
<a href=https://mapstruct.org/documentation/stable/reference/html/ title=MapStruct官方文档 rel="noopener external nofollow noreferrer" target=_blank class=exturl>MapStruct官方文档
<i class="fa fa-external-link-alt"></i></a></p><h2 id=介绍>介绍</h2><p>MapStruct是一个对象转换映射工具，用来不同类型责则对象间的转换，如DO、DTO、VO之间的互转，我们来看看官网的介绍。</p><blockquote><p>MapStruct is a Java annotation processor for the generation of type-safe and performant mappers for Java bean classes. It saves you from writing mapping code by hand, which is a tedious and error-prone task. The generator comes with sensible defaults and many built-in type conversions, but it steps out of your way when it comes to configuring or implementing special behavior.
简单翻译一下：MapStruct 是一个 Java 注释处理器，用于为 Java bean 类生成类型安全和高性能的映射器。它使您免于手动编写映射代码，这是一项繁琐且容易出错的工作。生成器带有合理的默认值和许多内置的类型转换，但在配置或实现特殊行为时它可能会比较繁琐。</p></blockquote><h2 id=为什么要用mapstruct>为什么要用MapStruct</h2><p>对象间的字段转换映射，已经用许多现成可用的方案，用的比较多的应该是Spring中自带的<strong>BeanUtils</strong>，用起来也十分方便，但是美中不足的是其底层原理是使用了反射去实现字段间的映射，性能方面就很一般了。而<strong>MapStruct</strong>在这一点上，使用<strong>getter</strong>、<strong>setter</strong>实现，性能远远高于<strong>BeanUtils</strong>，以下是官网所描述的优点：</p><ul><li>Fast execution by using plain method invocations instead of reflection</li><li>Compile-time type safety. Only objects and attributes mapping to each other can be mapped, so there&rsquo;s no accidental mapping of an order entity into a customer DTO, etc.</li><li>Self-contained code—no runtime dependencies</li><li>Clear error reports at build time if:<ul><li>mappings are incomplete (not all target properties are mapped)</li><li>mappings are incorrect (cannot find a proper mapping method or type conversion)</li></ul></li><li>Easily debuggable mapping code (or editable by hand—e.g. in case of a bug in the generator)
简单翻译一下：</li><li>通过使用普通方法调用而不是反射来实现快速执行</li><li>编译时类型安全。只能映射相互映射的对象和属性，因此不会出现将订单实体类意外映射到客户 DTO类 等。</li><li>自包含代码——无运行时依赖</li><li>如果出现以下情况，编译时可以被发现：<ul><li>映射不完整（并非所有目标属性都已映射）</li><li>映射不正确（找不到合适的映射方法或类型转换）</li></ul></li><li>易于调试的映射代码（或可手动编辑——例如，在生成器中出现错误的情况下）</li></ul><h2 id=使用>使用</h2><h3 id=引入相关依赖>引入相关依赖</h3><h4 id=maven>Maven</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;org.mapstruct.version&gt;</span>1.5.3.Final<span style=color:#f92672>&lt;/org.mapstruct.version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.mapstruct<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>mapstruct<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;version&gt;</span>${org.mapstruct.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>maven-compiler-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>3.8.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;source&gt;</span>1.8<span style=color:#f92672>&lt;/source&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;target&gt;</span>1.8<span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;annotationProcessorPaths&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;path&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;groupId&gt;</span>org.mapstruct<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;artifactId&gt;</span>mapstruct-processor<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;version&gt;</span>${org.mapstruct.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;/path&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/annotationProcessorPaths&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/build&gt;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h4 id=gradle>Gradle</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#34;com.diffplug.eclipse.apt&#34;</span> version <span style=color:#e6db74>&#34;3.26.0&#34;</span> <span style=color:#75715e>// Only for Eclipse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.mapstruct:mapstruct:1.5.3.Final&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    annotationProcessor <span style=color:#e6db74>&#39;org.mapstruct:mapstruct-processor:1.5.3.Final&#39;</span>
</span></span><span style=display:flex><span>    testAnnotationProcessor <span style=color:#e6db74>&#39;org.mapstruct:mapstruct-processor:1.5.3.Final&#39;</span> <span style=color:#75715e>// if you are using mapstruct in test code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><h4 id=mapstruct整合lombok>MapStruct整合Lombok</h4><p>MapStruce和Lombok的实现原理类似，都是在编译期间对原有代码进行增强，生成对应代码，所以MapStruce和Lombok同时使用时，需注意一下pom文件的配置。
<a href=https://mapstruct.org/documentation/stable/reference/html/#lombok title=MapStruce官网关于Lombok的说明 rel="noopener external nofollow noreferrer" target=_blank class=exturl>MapStruce官网关于Lombok的说明
<i class="fa fa-external-link-alt"></i></a>
可以参考以下pom配置文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maven.compiler.source&gt;</span>13<span style=color:#f92672>&lt;/maven.compiler.source&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maven.compiler.target&gt;</span>13<span style=color:#f92672>&lt;/maven.compiler.target&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;project.build.sourceEncoding&gt;</span>UTF-8<span style=color:#f92672>&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;org.mapstruct.version&gt;</span>1.5.3.Final<span style=color:#f92672>&lt;/org.mapstruct.version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;org.projectlombok.version&gt;</span>1.18.24<span style=color:#f92672>&lt;/org.projectlombok.version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;lombok-mapstruct-binding.version&gt;</span>0.2.0<span style=color:#f92672>&lt;/lombok-mapstruct-binding.version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.mapstruct<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>mapstruct<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>${org.mapstruct.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>${org.projectlombok.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>provided<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>maven-compiler-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;version&gt;</span>3.8.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;source&gt;</span>13<span style=color:#f92672>&lt;/source&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;target&gt;</span>13<span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;annotationProcessorPaths&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;path&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;groupId&gt;</span>org.mapstruct<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;artifactId&gt;</span>mapstruct-processor<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;version&gt;</span>${org.mapstruct.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;/path&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;path&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>&lt;version&gt;</span>${org.projectlombok.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;/path&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>&lt;!--lombok版本大于1.18.16 需配置以下path&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                        &lt;path&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                            &lt;artifactId&gt;lombok-mapstruct-binding&lt;/artifactId&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                            &lt;version&gt;${lombok-mapstruct-binding.version}&lt;/version&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                        &lt;/path&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                    &lt;/annotationProcessorPaths&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                &lt;/configuration&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            &lt;/plugin&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>        &lt;/plugins&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>    &lt;/build&gt;
</span></span></span></code></pre></div><h3 id=开始使用>开始使用</h3><h4 id=创建需要映射的实体类>创建需要映射的实体类</h4><p>首先，我们创建一个用户实体类DO，和对应的DTO，字段先保持一致。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=创建mapper映射>创建Mapper映射</h4><p>创建一个接口，并使用MapStruct的@Mapper注解，MapStruct就可以生成对应的映射代码，实现对象间的映射转换。</p><h5 id=创建通用泛型映射mapper>创建通用泛型映射Mapper</h5><p>我们可以将原实体类和目标实体类用泛型抽象出来，写一个通用的映射Mapper。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>BaseMapStruct</span><span style=color:#f92672>&lt;</span>SOURCE<span style=color:#f92672>,</span>TARGET<span style=color:#f92672>&gt;{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    TARGET <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>SOURCE source<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    SOURCE <span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>TARGET target<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>SOURCE<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toSourceList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>TARGET<span style=color:#f92672>&gt;</span> targetList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>TARGET<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toTargetList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>SOURCE<span style=color:#f92672>&gt;</span> sourceList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=创建具体的mapper>创建具体的Mapper</h5><p>有了通用的Mapper，具体类的Mapper只需要创建对应的接口并实现BaseMapStruct即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span> <span style=color:#75715e>//使用Spring容器托管类
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>       <span style=color:#75715e>//特殊的字段转换处理 可以在具体的映射器上实现
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=测试基本映射>测试基本映射</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>).</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>执行结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-14 22:26:06.265  INFO 8776 --- [           main] c.t.learning.MapStructApplicationTest    : UserDTO(name=test, age=18, gender=man, phoneNumber=12345678)
</span></span></code></pre></div><h5 id=查看mapstruct自动生成的映射实现类>查看MapStruct自动生成的映射实现类</h5><p>MapStruct通过解析注解，在编译期间生成对应映射器的实现类，我们打开target文件夹中的对应路径，看一下自动生成的内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserMapStructImpl</span> <span style=color:#66d9ef>implements</span> UserMapStruct <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserMapStructImpl</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO source<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>source <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            UserDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>UserDTOBuilder</span> userDTO <span style=color:#f92672>=</span> UserDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span>source<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span>source<span style=color:#f92672>.</span><span style=color:#a6e22e>getAge</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span>source<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span>source<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhoneNumber</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDO <span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>UserDTO target<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>target <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>UserDOBuilder</span> userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getAge</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhoneNumber</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toSourceList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> targetList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>targetList <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>(</span>targetList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            Iterator var3 <span style=color:#f92672>=</span> targetList<span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                UserDTO userDTO <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>UserDTO<span style=color:#f92672>)</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toTargetList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> sourceList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sourceList <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>(</span>sourceList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            Iterator var3 <span style=color:#f92672>=</span> sourceList<span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                UserDO userDO <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>UserDO<span style=color:#f92672>)</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>由于使用类Spring容器托管，MapStruct自动生成了**@Component<strong>注解，将Bean注册到容器中，所以我们可以使用</strong>@Resoure**直接进行注入并使用。由于继承了泛型的Mapper，所以也生成了泛型Mapper中所定义的通用转换方法。值得注意的是，如果转换的对象使用了Lombok的Builder注解，MapStruct会使用对应的Builder去创建对象，反之则直接使用new的方式创建。</p><h3 id=自定义字段间映射>自定义字段间映射</h3><h4 id=字段名不同>字段名不同</h4><p>在真实的业务场景中，往往会出现相互转换的实体间字段名称不一样的情况，MapStruct也提供了对应注解**@Mapping<strong>来解决这个问题。
比如，UserDO的字段phoneNumber对应的是UserDTO的phoneNum字段，我们可以使用</strong>@Mapping**将其映射。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNum<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    UserDO <span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>UserDTO userDTO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toSourceList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> userDTOS<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toTargetList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> userDOS<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=运行结果>运行结果</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>).</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-15 21:47:41.370  INFO 65373 --- [           main] c.t.learning.MapStructApplicationTest    : UserDTO(name=test, age=18, gender=man, phoneNum=12345678)
</span></span><span style=display:flex><span>2023-01-15 21:47:41.371  INFO 65373 --- [           main] c.t.learning.MapStructApplicationTest    : UserDO(name=test, age=18, gender=man, phoneNumber=12345678)
</span></span></code></pre></div><h4 id=多个数据源>多个数据源</h4><p>在某些场景下，一个DTO类的数据源往往不只来源于一个DO类。比如一个UserDTO类可能还要有其权限、用户组，头像等信息字段，这些字段的值不一定都来自于UserDO类，可能有对应的RuleDO类等。这种情况下，使用**@Mapping**注解也可以解决。
首先我们新建RuleDO类。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RoleDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 名称
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 编码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    String code<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>UserDTO新增roleName、roleCode字段。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNum<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String roleName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String roleCode<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>映射类中添加对应映射注解，值得注意的是，如果两个数据源类中都存在目标类中的字段，也需要使用**@Mapping**标记需要使用其中的哪一个。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    UserDO <span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>UserDTO userDTO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toSourceList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> userDTOS<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toTargetList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> userDOS<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mappings</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.name&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>),</span> <span style=color:#75715e>//由于UserDO和RoleDO中都存在name字段，所以需使用注解表明使用哪一个
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleDO.name&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleName&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleDO.code&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleCode&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    UserDTO <span style=color:#a6e22e>toUserDTO</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>,</span> RoleDO roleDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=运行结果-1>运行结果</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        RoleDO roleDO <span style=color:#f92672>=</span> RoleDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;管理员&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>code</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toUserDTO</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>,</span>roleDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-15 22:47:55.156  INFO 79977 --- [           main] c.t.learning.MapStructApplicationTest    : UserDTO(name=test, age=18, gender=man, phoneNum=12345678, roleName=管理员, roleCode=admin)
</span></span></code></pre></div><h4 id=子对象与子对象间的映射>子对象与子对象间的映射</h4><h5 id=子对象的映射>子对象的映射</h5><p>对象中如果存在子对象，那子对象中的字段也是可以平铺映射到一个类中的，也是使用**@Mapping**注解去指定映射。
比如现在userDO类中组合了RoleDO类。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RoleDO roleDO<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>修改映射规则。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mappings</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.phoneNumber&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phoneNum&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.name&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.roleDO.name&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleName&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userDO.roleDO.code&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleCode&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h6 id=运行结果-2>运行结果</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        RoleDO roleDO <span style=color:#f92672>=</span> RoleDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;管理员&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>code</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>roleDO</span><span style=color:#f92672>(</span>roleDO<span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-16 22:00:39.916  INFO 52252 --- [           main] c.t.learning.MapStructApplicationTest    : UserDTO(name=test, age=18, gender=man, phoneNum=12345678, roleName=管理员, roleCode=admin)
</span></span></code></pre></div><h5 id=子对象的映射-1>子对象的映射</h5><p>如果源对象与目标对象中各自有对应的子对象，比如UserDO和UserDTO中各自有各自的RoleDO和RoleDTO类，这种情况也是可以成功进行映射转换的，，当然，也是通过配置**@Mapping**实现的。
首先创建对应的Role类。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RoleDTO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 名称
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 编码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String code<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RoleDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 名称
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 编码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String code<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后创建子对象的映射器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>RoleMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>RoleDO<span style=color:#f92672>,</span> RoleDTO<span style=color:#f92672>&gt;{</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>//可以在这里实现特殊处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后在User的映射器中**@Mapping**使用uses，将RoleMapStruct引入，User映射器中就可以使用引入的RoleMapStruct进行子对象的映射了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>,</span> uses <span style=color:#f92672>=</span> RoleMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleDO&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;roleDTO&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>//字段名不一致，手动指定
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h6 id=运行结果-3>运行结果</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> JsonProcessingException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RoleDO roleDO <span style=color:#f92672>=</span> RoleDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;管理员&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>code</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>roleDO</span><span style=color:#f92672>(</span>roleDO<span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-16 23:02:27.911  INFO 67249 --- [           main] c.t.learning.MapStructApplicationTest    : {&#34;name&#34;:&#34;test&#34;,&#34;age&#34;:18,&#34;gender&#34;:&#34;man&#34;,&#34;phoneNumber&#34;:&#34;12345678&#34;,&#34;roleDTO&#34;:{&#34;name&#34;:&#34;管理员&#34;,&#34;code&#34;:&#34;admin&#34;}}
</span></span></code></pre></div><h4 id=基本类型的隐式转换和字符串的格式化>基本类型的隐式转换和字符串的格式化</h4><p>有的时候，映射的两个类之间的字段类型并不会完全一致，如果对应字段为基本数据类型和他们的包装类型，则MapStruct会自动进行空值判断并映射赋值。值得注意的是，如果出现数据范围大的类型映射到数据范围较小的类型如从long到int，则会出现精度丢失的问题，我们可以在<strong>Mapper</strong>注解中设置处理策略，由于向下兼容，默认为ReportingPolicy.IGNORE。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer height<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date createDate<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> age<span style=color:#f92672>;</span>            <span style=color:#75715e>//基本类型间自动映射
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String height<span style=color:#f92672>;</span>      <span style=color:#75715e>//数字字符串格式化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String createDate<span style=color:#f92672>;</span>  <span style=color:#75715e>//日期格式化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mappings</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;createDate&#34;</span><span style=color:#f92672>,</span>dateFormat <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;yyyy-MM-dd&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;createDate&#34;</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>,</span>numberFormat <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#cm&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>)})</span>
</span></span><span style=display:flex><span>    UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=运行结果-4>运行结果</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> JsonProcessingException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>createDate</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Date<span style=color:#f92672>()).</span><span style=color:#a6e22e>height</span><span style=color:#f92672>(</span><span style=color:#ae81ff>180</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-20 22:03:17.990  INFO 99724 --- [           main] c.t.learning.MapStructApplicationTest    : {&#34;name&#34;:&#34;test&#34;,&#34;age&#34;:18,&#34;gender&#34;:&#34;man&#34;,&#34;height&#34;:&#34;180cm&#34;,&#34;phoneNumber&#34;:&#34;12345678&#34;,&#34;createDate&#34;:&#34;2023-01-20&#34;}
</span></span></code></pre></div><h4 id=自定义映射前和映射后的处理>自定义映射前和映射后的处理</h4><p>MapStruct提供了两个注解，分别是<strong>AfterMapping</strong>，<strong>BeforeMapping</strong>用来处理映射前和映射后的自定义实现。以用户类为例，我们可以在映射前设置默认身高，在映射后判断是否为管理员。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDO</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer height<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String roleName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date createDate<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String height<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String createDate<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Boolean admin<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String roleName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>值得注意的是，如果使用<strong>AfterMapping</strong>，<strong>BeforeMapping</strong>，@Mapper注解需使用在抽象类中，当实体类使用Builder模式时，则@AfterMapping中需传入对应的Builder，或者是将@Mapper注解中的构造器声明关闭(builder = @Builder(disableBuilder = true))。
如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>,</span>builder <span style=color:#f92672>=</span> <span style=color:#a6e22e>@Builder</span><span style=color:#f92672>(</span>disableBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>))</span>  <span style=color:#75715e>//实体类使用构建器模式时，需关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserMapper</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeMapping</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setDefHeight</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>ObjectUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>())){</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>setHeight</span><span style=color:#f92672>(</span><span style=color:#ae81ff>170</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@AfterMapping</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAdmin</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@MappingTarget</span> UserDTO userDTO<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdmin</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>getRoleName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=运行结果-5>运行结果</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapper userMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapStruct</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> JsonProcessingException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span><span style=color:#ae81ff>18</span><span style=color:#f92672>).</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;12345678&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;man&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>createDate</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Date<span style=color:#f92672>()).</span><span style=color:#a6e22e>roleName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        UserDTO userDTO <span style=color:#f92672>=</span> userMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-25 13:13:06.347  INFO 6247 --- [           main] c.t.learning.MapStructApplicationTest    : {&#34;name&#34;:&#34;test&#34;,&#34;age&#34;:18,&#34;gender&#34;:&#34;man&#34;,&#34;height&#34;:&#34;170&#34;,&#34;phoneNumber&#34;:&#34;12345678&#34;,&#34;createDate&#34;:&#34;2023/1/25 下午1:13&#34;,&#34;admin&#34;:true,&#34;roleName&#34;:&#34;admin&#34;}
</span></span></code></pre></div><h4 id=将map映射到bean>将Map映射到Bean</h4><p>在某些特殊的情况下，需要从Map中映射到特定的Bean中，MapStruct也提供了对应的支持，通过<strong>Mapping</strong>注解，同时可以自定义字段名映射规则。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span><span style=color:#f92672>(</span>componentModel <span style=color:#f92672>=</span> MappingConstants<span style=color:#f92672>.</span><span style=color:#a6e22e>ComponentModel</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SPRING</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapStruct</span> <span style=color:#66d9ef>extends</span> BaseMapStruct<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>,</span> UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Mapping</span><span style=color:#f92672>(</span>source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;userName&#34;</span><span style=color:#f92672>,</span>target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>//将map中userName为key的值映射到UserDO类中的name字段
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    UserDO <span style=color:#a6e22e>toUserDO</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> map<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=运行结果-6>运行结果</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapStructApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    UserMapStruct userMapStruct<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapToBean</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> JsonProcessingException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Map userMap <span style=color:#f92672>=</span> Map<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userName&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;testName&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;roleName&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        UserDO userDO <span style=color:#f92672>=</span> userMapStruct<span style=color:#f92672>.</span><span style=color:#a6e22e>toUserDO</span><span style=color:#f92672>(</span>userMap<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2023-01-27 18:27:54.915  INFO 16729 --- [           main] c.t.learning.MapStructApplicationTest    : {&#34;name&#34;:&#34;testName&#34;,&#34;age&#34;:null,&#34;height&#34;:2,&#34;roleName&#34;:&#34;admin&#34;,&#34;gender&#34;:null,&#34;phoneNumber&#34;:null,&#34;createDate&#34;:null}
</span></span></code></pre></div><h3 id=简单分析下原理>简单分析下原理</h3><p>善于仔细观察的同学应该已经发现了，使用了MapStruct后，在编译后的<strong>target</strong>目录中，会多出几个<strong>Mapper</strong> 的实现类。我们可以简单的看一下生成的Class。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserMapStructImpl</span> <span style=color:#66d9ef>implements</span> UserMapStruct <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserMapStructImpl</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDO <span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>UserDTO target<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>target <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>UserDOBuilder</span> userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getAge</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>height</span><span style=color:#f92672>(</span>Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>roleName</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getRoleName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhoneNumber</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getCreateDate</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>createDate</span><span style=color:#f92672>((</span><span style=color:#66d9ef>new</span> SimpleDateFormat<span style=color:#f92672>()).</span><span style=color:#a6e22e>parse</span><span style=color:#f92672>(</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>getCreateDate</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ParseException var4<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>var4<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toSourceList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> targetList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>targetList <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>(</span>targetList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            Iterator var3 <span style=color:#f92672>=</span> targetList<span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                UserDTO userDTO <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>UserDTO<span style=color:#f92672>)</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toSource</span><span style=color:#f92672>(</span>userDTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>toTargetList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>UserDO<span style=color:#f92672>&gt;</span> sourceList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sourceList <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>UserDTO<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>(</span>sourceList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            Iterator var3 <span style=color:#f92672>=</span> sourceList<span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                UserDO userDO <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>UserDO<span style=color:#f92672>)</span>var3<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDTO <span style=color:#a6e22e>toTarget</span><span style=color:#f92672>(</span>UserDO userDO<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>userDO <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            UserDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>UserDTOBuilder</span> userDTO <span style=color:#f92672>=</span> UserDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getCreateDate</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>createDate</span><span style=color:#f92672>((</span><span style=color:#66d9ef>new</span> SimpleDateFormat<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;yyyy-MM-dd&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>format</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getCreateDate</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>height</span><span style=color:#f92672>((</span><span style=color:#66d9ef>new</span> DecimalFormat<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;#cm&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>format</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getAge</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getAge</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getGender</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhoneNumber</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>roleName</span><span style=color:#f92672>(</span>userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>getRoleName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userDTO<span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDO <span style=color:#a6e22e>toUserDO</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> map<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>UserDOBuilder</span> userDO <span style=color:#f92672>=</span> UserDO<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userName&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userName&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;age&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>(</span>Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;age&#34;</span><span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>height</span><span style=color:#f92672>(</span>Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;roleName&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>roleName</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;roleName&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;gender&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>gender</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;gender&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>phoneNumber</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;phoneNumber&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;createDate&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>createDate</span><span style=color:#f92672>((</span><span style=color:#66d9ef>new</span> SimpleDateFormat<span style=color:#f92672>()).</span><span style=color:#a6e22e>parse</span><span style=color:#f92672>((</span>String<span style=color:#f92672>)</span>map<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;createDate&#34;</span><span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ParseException var4<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>var4<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userDO<span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>MapStruct通过扫描解析<strong>Mapper</strong>注解，在编译的过程中生成对应的实现类的代码，从而实现对象间复杂的映射。问题来了，MapStruct是怎么在编译过程中生成额外的代码？这个就涉及到JSR269所提供的一套API<strong>注解处理器</strong>(Annotation Processor Tool),简称APT。</p><h4 id=注解处理器annotation-processor-tool>注解处理器(Annotation Processor Tool)</h4><p>APT允许我们在编译期访问和处理注解元数据，修改或创建源文件或类文件，像反射一样访问类、字段、方法和注解等元素。它可以用于减少样板代码，实现代码生成器，检查代码规范等等。要实现一个注解处理器，我们需要继承AbstractProcessor类，重写process方法，并在META-INF/services目录下注册我们的注解处理器。Lombok就是一个利用JSR269规范实现的插件，它可以通过注解来自动生成getter，setter，toString等方法。</p><h3 id=总结>总结</h3><p>和Lombok的原理一样，MapStruct通过注解处理器，在编译的过程中扫描注解，生成对应的对应映射代码，大大方便了对象间的相互映射操作，不仅提高了开发效率，而且与其他实现方式相比，它的转换性能也是比反射要高的。在频繁需要映射对象的场景下尤为明显。可以说是一个优秀的代码工具了。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/mapstruct>MapStruct</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
MapStruct对象映射工具的使用</li><li class=post-copyright-author><strong>本文作者：</strong>
Teoan</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://teoan.github.io/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/ title=MapStruct对象映射工具的使用>https://teoan.github.io/post/mapstruct%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=/post/%E5%9F%8E%E5%B8%82%E5%A4%A7%E6%A5%BC%E5%92%96%E5%95%A1%E5%8E%85%E6%97%A9%E8%B5%B7%E5%8D%88%E9%A4%90%E8%AF%B4%E6%99%9A%E5%AE%89/ rel=prev title=城市大楼咖啡厅,早起午餐说晚安>城市大楼咖啡厅,早起午餐说晚安
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-paper-plane"></i></span>
<span class=author itemprop=copyrightHolder>Teoan</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://teoan.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.5207e106e9f92dcba41e11e145b3dea597901a731ea853825859c3c82c35adf6.js defer></script></body></html>