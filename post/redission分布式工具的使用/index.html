<!doctype html><html lang=zh-cn data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.108.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/x-icon href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-16.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-32.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-96.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/icons8-%e5%85%a5%e5%8f%a3-gradient-120.png><meta itemprop=name content="Redission分布式工具的使用"><meta itemprop=description content="保持对技术的热爱"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://teoan.github.io/imgs/profile_20180304_000045_1.png"><meta itemprop=keywords content="redis,redission"><meta property="og:type" content="article"><meta property="og:title" content="Redission分布式工具的使用"><meta property="og:description" content="保持对技术的热爱"><meta property="og:image" content="/imgs/profile_20180304_000045_1.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://teoan.github.io/post/redission%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="Teoan's Notes"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Teoan"><meta property="article:published_time" content="2022-12-25 17:15:55 +0000 UTC"><meta property="article:modified_time" content="2022-12-25 17:15:55 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.8dfa56c63ced9d8fef37c21ecb7cbc0dcac8c2862affd6eacfb5ea8ae5fb775c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"redission%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8","permalink":"https://teoan.github.io/post/redission%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/","title":"Redission分布式工具的使用","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Redission分布式工具的使用 - Teoan's Notes</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Teoan's Notes</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>积一时之跬步 臻千里之遥程</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>15</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#什么是redisson>什么是Redisson</a></li><li><a href=#springboot项目集成redission分布式工具>SpringBoot项目集成Redission分布式工具</a><ul><li><a href=#依赖的选择>依赖的选择</a></li><li><a href=#版本的选择>版本的选择</a></li><li><a href=#配置redisson>配置Redisson</a><ul><li><a href=#使用通用的springboot配置>使用通用的SpringBoot配置</a></li><li><a href=#使用redisson独立的配置>使用Redisson独立的配置</a></li></ul></li><li><a href=#验证配置是否成功>验证配置是否成功</a></li></ul></li><li><a href=#使用redisson>使用Redisson</a><ul><li><a href=#分布式对象>分布式对象</a><ul><li><a href=#话题订阅分发>话题(订阅分发)</a></li><li><a href=#限流器ratelimiter>限流器(RateLimiter)</a></li></ul></li><li><a href=#分布式集合>分布式集合</a><ul><li><a href=#映射缓存rmapcache>映射缓存(RMapCache)</a></li><li><a href=#多值映射rmultimap>多值映射(RMultimap)</a></li></ul></li><li><a href=#分布式锁>分布式锁</a><ul><li><a href=#可重入锁>可重入锁</a></li><li><a href=#信号量>信号量</a></li></ul></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Teoan src=/imgs/img-lazy-loading.gif data-src=/imgs/profile_20180304_000045_1.png><p class=site-author-name itemprop=name>Teoan</p><div class=site-description itemprop=description>保持对技术的热爱</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>2</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>21</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/Teoan title="Github → https://github.com/Teoan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=mailto:d277077411@gmail.com title="E-Mail → mailto:d277077411@gmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2018-08-28T11:27:03+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=22773></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=55></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-03-25T17:15:55+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/Teoan rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://teoan.github.io/post/redission%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/profile_20180304_000045_1.png"><meta itemprop=name content="Teoan"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Teoan"><meta itemprop=description content="保持对技术的热爱"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Redission分布式工具的使用"><meta itemprop=description content="前言 记得上一次使用Redis的时候，还是在自己做的毕业设计项目上，当时抱着学习的目的，简单地做了查询的缓存处理。当然，在现在看来，小项目的简"></span><header class=post-header><h1 class=post-title itemprop="name headline">Redission分布式工具的使用</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-12-25 17:15:55 +0000 UTC" itemprop="dateCreated datePublished" datetime="2022-12-25 17:15:55 +0000 UTC">2022-12-25</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%8A%80%E6%9C%AF itemprop=url rel=index><span itemprop=name>技术</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>4764</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>10分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/post/redission%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=前言>前言</h2><p>记得上一次使用Redis的时候，还是在自己做的毕业设计项目上，当时抱着学习的目的，简单地做了查询的缓存处理。当然，在现在看来，小项目的简单查询根本用不到Redis来作为缓存中间件。而在实际的工作中，Rediss的使用，一般都用来缓存一些加载或者查询比较费时的、实时性要求比较低的数据，以提高web应用接口响应速度，进而提升用户体验。最近了解到Redission分布式工具，于是便有了这篇文章，记录下自己的使用过程。</p><h2 id=什么是redisson>什么是Redisson</h2><p>以下是
<a href=https://github.com/redisson/redisson/wiki/1.-%E6%A6%82%E8%BF%B0 title=Redisson官方 rel="noopener external nofollow noreferrer" target=_blank class=exturl>Redisson官方
<i class="fa fa-external-link-alt"></i>
</a>的一段描述</p><blockquote><p>Redisson是一个在Redis的基础上实现的Java驻内存数据网格(In-Memory Data Grid)。它不仅提供了一系列的分布式的Java常用对象，还提供了许多分布式服务。其中包括(BitSet, Set, Multimap, SortedSet, Map, List, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, AtomicLong, CountDownLatch, Publish / Subscribe, Bloom filter, Remote service, Spring cache, Executor service, Live Object service, Scheduler service) Redisson提供了使用Redis的最简单和最便捷的方法。Redisson的宗旨是促进使用者对Redis的关注分离(Separation of Concern)，从而让使用者能够将精力更集中地放在处理业务逻辑上。</p></blockquote><h2 id=springboot项目集成redission分布式工具>SpringBoot项目集成Redission分布式工具</h2><p>集成Redission，一般集成SpringBoot项目模块，我都会在
<a href=https://mvnrepository.com/ title=maven官方仓库 rel="noopener external nofollow noreferrer" target=_blank class=exturl>maven官方仓库
<i class="fa fa-external-link-alt"></i>
</a>搜索对应的依赖包。目前仓库上使用的最多的依赖包有两个。</p><h3 id=依赖的选择>依赖的选择</h3><p><strong>一个是Redisson原生依赖</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.redisson<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>redisson<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>3.17.7<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><strong>一个是SpringBoot官方提供的Starter包</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson-spring-boot-starter --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.redisson<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>redisson-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>3.17.7<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>其实两个依赖包使用起来没多大区别，只是SpringBoot官方提供的Start包对spring应用有更好的支持。具体选择哪个，就看自己喜欢了。</p><h3 id=版本的选择>版本的选择</h3><p>Redisson的版本需要与SpringBoot的版本相对应，不然容易出现一些兼容性的问题。如果使用starter包引入的方式，我们可以参考
<a href=https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter title=redisson-spring-boot-starter官方 rel="noopener external nofollow noreferrer" target=_blank class=exturl>redisson-spring-boot-starter官方
<i class="fa fa-external-link-alt"></i>
</a>给出的对应版本关系，选择对应的版本就好了。以下来自官方给出的版本对应关系。</p><table><thead><tr><th>redisson-spring-data<br>module name</th><th>Spring Boot<br>version</th></tr></thead><tbody><tr><td>redisson-spring-data-16</td><td>1.3.y</td></tr><tr><td>redisson-spring-data-17</td><td>1.4.y</td></tr><tr><td>redisson-spring-data-18</td><td>1.5.y</td></tr><tr><td>redisson-spring-data-2x</td><td>2.x.y</td></tr></tbody></table><p>查看自己引入的redisson-spring-boot-starter版本号是否与SpringBoot对应。
<img src=/imgs/img-lazy-loading.gif data-src=resources/_gen/images/281973622248073.png alt=查看引入的版本号></p><h3 id=配置redisson>配置Redisson</h3><p>配置Redisson可以有多种方式，如通过Config对象读取文件yaml文件等。而实际使用的最多的应该是集成在SpringBoot中，在分布式场景下，就可以统一在配置中心进行修改，根据不同环境的Redis部署方式，配置不同的Redisson配置。</p><h4 id=使用通用的springboot配置>使用通用的SpringBoot配置</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>database</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>host</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cluster</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodes</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>sentinel</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>master</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodes</span>:
</span></span></code></pre></div><h4 id=使用redisson独立的配置>使用Redisson独立的配置</h4><h5 id=集群模式>集群模式</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>redisson</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>file</span>: <span style=color:#ae81ff>classpath:redisson.yaml</span> <span style=color:#75715e>#这里可以使用外部文件，也可以直接在config中配置</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        clusterServersConfig:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            idleConnectionTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            timeout: 3000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryAttempts: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryInterval: 1500
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            password: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionsPerConnection: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            clientName: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            loadBalancer: !&lt;org.redisson.connection.balancer.RoundRobinLoadBalancer&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionMinimumIdleSize: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionPoolSize: 50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            readMode: &#34;SLAVE&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            nodeAddresses:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:7004&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:7001&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:7000&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            scanInterval: 1000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        threads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        nettyThreads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        codec: !&lt;org.redisson.codec.JsonJacksonCodec&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        transportMode: &#34;NIO&#34;</span>        
</span></span></code></pre></div><h5 id=单redis节点模式>单Redis节点模式</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>redisson</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        singleServerConfig:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            idleConnectionTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            timeout: 3000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryAttempts: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryInterval: 1500
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            password: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionsPerConnection: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            clientName: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            address: &#34;redis://127.0.0.1:6379&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionConnectionMinimumIdleSize: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionConnectionPoolSize: 50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            database: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            dnsMonitoringInterval: 5000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        threads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        nettyThreads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        codec: !&lt;org.redisson.codec.JsonJacksonCodec&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        transportMode: &#34;NIO&#34;</span>        
</span></span></code></pre></div><h5 id=哨兵模式>哨兵模式</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>redisson</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        sentinelServersConfig:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            idleConnectionTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            timeout: 3000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryAttempts: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryInterval: 1500
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            password: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionsPerConnection: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            clientName: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            loadBalancer: !&lt;org.redisson.connection.balancer.RoundRobinLoadBalancer&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionMinimumIdleSize: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionPoolSize: 50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            readMode: &#34;SLAVE&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            sentinelAddresses:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:26379&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:26389&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterName: &#34;mymaster&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            database: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        threads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        nettyThreads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        codec: !&lt;org.redisson.codec.JsonJacksonCodec&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        transportMode: &#34;NIO&#34;</span>        
</span></span></code></pre></div><h5 id=主从模式>主从模式</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>redisson</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        masterSlaveServersConfig:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            idleConnectionTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectTimeout: 10000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            timeout: 3000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryAttempts: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            retryInterval: 1500
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            failedAttempts: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            password: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            subscriptionsPerConnection: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            clientName: null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            loadBalancer: !&lt;org.redisson.connection.balancer.RoundRobinLoadBalancer&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionMinimumIdleSize: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveSubscriptionConnectionPoolSize: 50
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionMinimumIdleSize: 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterConnectionPoolSize: 64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            readMode: &#34;SLAVE&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            slaveAddresses:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:6381&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - &#34;redis://127.0.0.1:6380&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            masterAddress: &#34;redis://127.0.0.1:6379&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            database: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        threads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        nettyThreads: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        codec: !&lt;org.redisson.codec.JsonJacksonCodec&gt; {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        transportMode: &#34;NIO&#34;</span>        
</span></span></code></pre></div><p>主流的配置就是上面的几种了, 各参数的含义可以参考具体的
<a href=https://github.com/redisson/redisson/wiki/2.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95 title=官方说明 rel="noopener external nofollow noreferrer" target=_blank class=exturl>官方说明
<i class="fa fa-external-link-alt"></i></a></p><h3 id=验证配置是否成功>验证配置是否成功</h3><p>编写测试类验证Redisson是否可用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRedissonClient</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RSet<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> set <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getSet</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;teoan&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        set<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>查看Redis中的数据
<img src=/imgs/img-lazy-loading.gif data-src=vx_images/388710016245576.png alt></p><p>可以看到redis中已经存在对应的Set集合数据,Redisson配置到这里就完了.</p><h2 id=使用redisson>使用Redisson</h2><h3 id=分布式对象>分布式对象</h3><p>Redisson提供的分布式对象有多个,如通用对象桶(Object Bucket)、二进制流(Binary Stream)、地理空间对象桶(Geospatial Bucket)、BitSet 原子整长形(AtomicLong)、原子双精度浮点(AtomicDouble)、话题(订阅分发)、布隆过滤器(Bloom Filter)等,每个Redisson对象实例都会有一个与之对应的Redis数据实例，可以通过调用getName方法来取得Redis数据实例的名称(key)。所有与Redis key相关的操作都归纳在RKeys这个接口,他们的使用方式具体可以
<a href=https://github.com/redisson/redisson/wiki/6.-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%B9%E8%B1%A1 title=参考官方wiki rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官方wiki
<i class="fa fa-external-link-alt"></i>
</a>,其中我比较感兴趣的是这个<strong>话题对象</strong>,它可以实现类似于订阅分发的功能,和消息队列的思想差不多,我就以<strong>话题对象</strong>为例子,玩一下这个分布式对象。</p><h4 id=话题订阅分发>话题(订阅分发)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    Executor execute<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRedissonClient</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RTopic topic <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getTopic</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Teoan&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        topic<span style=color:#f92672>.</span><span style=color:#a6e22e>addListener</span><span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,(</span>channel<span style=color:#f92672>,</span> message<span style=color:#f92672>)-&gt;{</span>
</span></span><span style=display:flex><span>           log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;鸡汤来咯，看看鸡汤里面是什么[{}]&#34;</span><span style=color:#f92672>,</span>message<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在其他线程或JVM节点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        execute<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()-&gt;{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>long</span> clientsReceivedMessage <span style=color:#f92672>=</span> topic<span style=color:#f92672>.</span><span style=color:#a6e22e>publish</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;毒药&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;clientsReceivedMessage:{}&#34;</span><span style=color:#f92672>,</span>clientsReceivedMessage<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>执行结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-text data-lang=text><span style=display:flex><span>  .   ____          _            __ _ _
</span></span><span style=display:flex><span> /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
</span></span><span style=display:flex><span>( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
</span></span><span style=display:flex><span> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
</span></span><span style=display:flex><span>  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
</span></span><span style=display:flex><span> =========|_|==============|___/=/_/_/_/
</span></span><span style=display:flex><span> :: Spring Boot ::                (v2.7.5)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2022-11-13 11:43:16.388  INFO 12056 --- [           main] c.t.l.test.RedissonApplicationTest       : Starting RedissonApplicationTest using Java 13.0.2 on Teoan-Desktop with PID 12056 (started by Teoan in F:\Linux\git_clone\TeoanStudy\Redisson)
</span></span><span style=display:flex><span>2022-11-13 11:43:16.389  INFO 12056 --- [           main] c.t.l.test.RedissonApplicationTest       : No active profile set, falling back to 1 default profile: &#34;default&#34;
</span></span><span style=display:flex><span>2022-11-13 11:43:19.326  INFO 12056 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
</span></span><span style=display:flex><span>2022-11-13 11:43:19.329  INFO 12056 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
</span></span><span style=display:flex><span>2022-11-13 11:43:19.461  INFO 12056 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 34 ms. Found 0 Redis repository interfaces.
</span></span><span style=display:flex><span>2022-11-13 11:43:23.770  INFO 12056 --- [           main] org.redisson.Version                     : Redisson 3.18.0
</span></span><span style=display:flex><span>2022-11-13 11:43:26.451  INFO 12056 --- [isson-netty-2-7] o.r.c.pool.MasterPubSubConnectionPool    : 1 connections initialized for 127.0.0.1/127.0.0.1:6379
</span></span><span style=display:flex><span>2022-11-13 11:43:26.559  INFO 12056 --- [isson-netty-2-3] o.r.c.pool.MasterConnectionPool          : 32 connections initialized for 127.0.0.1/127.0.0.1:6379
</span></span><span style=display:flex><span>2022-11-13 11:43:27.529  INFO 12056 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 1 endpoint(s) beneath base path &#39;/actuator&#39;
</span></span><span style=display:flex><span>2022-11-13 11:43:27.600  INFO 12056 --- [           main] c.t.l.test.RedissonApplicationTest       : Started RedissonApplicationTest in 12.609 seconds (JVM running for 18.62)
</span></span><span style=display:flex><span>2022-11-13 11:43:28.821  INFO 12056 --- [         task-1] c.t.l.test.RedissonApplicationTest       : clientsReceivedMessage:1
</span></span><span style=display:flex><span>2022-11-13 11:43:28.822  INFO 12056 --- [   redisson-3-2] c.t.l.test.RedissonApplicationTest       : 鸡汤来咯，看看鸡汤里面是什么[毒药]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>进程已结束,退出代码0
</span></span></code></pre></div><h4 id=限流器ratelimiter>限流器(RateLimiter)</h4><p>简单讲一下限流器的用途，限流器用于限制总并发数，比如数据库连接池、线程池等。Redisson中的RateLimiter和Guava RateLimiter一样，也是使用令牌桶的限流算法，而不同的是，Redisson中的RateLimiter可以用来在分布式环境下现在请求方的调用频率。既适用于不同Redisson实例下的多线程限流，也适用于相同Redisson实例下的多线程限流。。算法逻辑大致为：令牌桶以固定的速率向桶中加入新的令牌，线程的请求会从桶里拿走一定数量的令牌，只要通中存在满足请求数量的令牌，请求就会被处理。比如我设置限流器一秒生成10个令牌，每个请求拿5个令牌，那么结果就是一秒最多处理2个请求。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    Executor execute<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRedissonRateLimiter</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RRateLimiter rateLimiter <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getRateLimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myRateLimiter&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 初始化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 最大流速 = 每1秒钟产生10个令牌
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        rateLimiter<span style=color:#f92672>.</span><span style=color:#a6e22e>trySetRate</span><span style=color:#f92672>(</span>RateType<span style=color:#f92672>.</span><span style=color:#a6e22e>OVERALL</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> RateIntervalUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 10个线程并发
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            execute<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()-&gt;{</span>
</span></span><span style=display:flex><span>                RRateLimiter limiter <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getRateLimiter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myRateLimiter&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 每次获取5个令牌
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>limiter<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5</span><span style=color:#f92672>)){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;get 5 tokens success&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;get 5 tokens fail&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2022-11-13 18:02:49.213  INFO 14872 --- [         task-1] c.t.l.test.RedissonApplicationTest       : get 5 tokens success
</span></span><span style=display:flex><span>2022-11-13 18:02:49.213  INFO 14872 --- [         task-3] c.t.l.test.RedissonApplicationTest       : get 5 tokens success
</span></span><span style=display:flex><span>2022-11-13 18:02:49.214  INFO 14872 --- [         task-2] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.215  INFO 14872 --- [         task-5] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.215  INFO 14872 --- [         task-6] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.216  INFO 14872 --- [         task-4] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.217  INFO 14872 --- [         task-3] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.219  INFO 14872 --- [         task-8] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.223  INFO 14872 --- [         task-7] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span><span style=display:flex><span>2022-11-13 18:02:49.225  INFO 14872 --- [         task-1] c.t.l.test.RedissonApplicationTest       : get 5 tokens fail
</span></span></code></pre></div><h3 id=分布式集合>分布式集合</h3><p>在Redisson提供的的集合类中，除了JDK中常见的Map，List，Set，还有一些在此基础上引申出来比较特殊集合对象，如映射缓存(RMapCache)、多值映射(RMultimap)、有序集(SortedSet)、计分排序集(ScoredSortedSet)等，除此之外，还有各种类型的队列对象，如双端队列(Deque)、阻塞队列(Blocking Queue)、有界阻塞队列(Bounded Blocking Queue)等。</p><h4 id=映射缓存rmapcache>映射缓存(RMapCache)</h4><p>RMapCache和RMap的区别在于多了一个<strong>元素淘汰功能</strong>，可以自定义Map中元素的<strong>有效时间</strong> 和 <strong>最长闲置时间</strong> 。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRMapCache</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        RMapCache<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapCache</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;anyMap&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 有效时间 ttl = 10分钟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MINUTES</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 有效时间 ttl = 10分钟, 最长闲置时间 maxIdleTime = 10秒钟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MINUTES</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 有效时间 = 3 秒钟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>putIfAbsent</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key2&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 有效时间 ttl = 40秒钟, 最长闲置时间 maxIdleTime = 10秒钟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>putIfAbsent</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key2&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>40</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=多值映射rmultimap>多值映射(RMultimap)</h4><p>多值映射，基于Redisson的RMultimap对象允许Map中的一个字段值包含多个元素。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRMultimap</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> <span style=color:#a6e22e>JsonProcessingException</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        RSetMultimap<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> myMultimap <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getSetMultimap</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myMultimap&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;value1&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;value2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;value3&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key2&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;value1&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key2&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;value2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> newValue1 <span style=color:#f92672>=</span> Set<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;newValue1&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;newValue2&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;newValue3&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> oldValues <span style=color:#f92672>=</span> myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceValues</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key1&#34;</span><span style=color:#f92672>,</span> newValue1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oldValues:[{}]&#34;</span><span style=color:#f92672>,</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>oldValues<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> removeValues <span style=color:#f92672>=</span> myMultimap<span style=color:#f92672>.</span><span style=color:#a6e22e>removeAll</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;key2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;removeValues:[{}]&#34;</span><span style=color:#f92672>,</span>objectMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>writeValueAsString</span><span style=color:#f92672>(</span>removeValues<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2022-11-20 16:59:33.540  INFO 28632 --- [           main] c.t.l.test.RedissonApplicationTest       : Started RedissonApplicationTest in 7.357 seconds (JVM running for 8.443)
</span></span><span style=display:flex><span>2022-11-20 16:59:34.216  INFO 28632 --- [           main] c.t.l.test.RedissonApplicationTest       : oldValues:[[&#34;value3&#34;,&#34;value2&#34;,&#34;value1&#34;]]
</span></span><span style=display:flex><span>2022-11-20 16:59:34.220  INFO 28632 --- [           main] c.t.l.test.RedissonApplicationTest       : removeValues:[[&#34;value2&#34;,&#34;value1&#34;]]
</span></span></code></pre></div><h3 id=分布式锁>分布式锁</h3><p>Redisson还提供了各种分布式锁，如可重入锁、公平锁、联锁、红锁等，这些锁对象也是完全符合Java的Lock规范，而且还提供异步（Async）、反射式（Reactive）和RxJava2标准的接口。</p><h4 id=可重入锁>可重入锁</h4><p>可重入锁，就是当前线程可以重复进入的锁，其他线程获取不到锁，则会阻塞。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    Executor execute<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestRLock</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RLock lock <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getLock</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;lock&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//另外的线程拿锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        execute<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()-&gt;{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 与主线程获取同一个锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            RLock rLock <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getLock</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;lock&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 加锁以后10秒钟自动解锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            rLock<span style=color:#f92672>.</span><span style=color:#a6e22e>lock</span><span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span>TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;其他线程拿到锁啦&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 10秒内拿不到锁 会阻塞
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        lock<span style=color:#f92672>.</span><span style=color:#a6e22e>lock</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;主线程拿到锁啦&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        lock<span style=color:#f92672>.</span><span style=color:#a6e22e>unlock</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2022-12-20 21:48:09.200  INFO 2587 --- [         task-1] c.t.l.test.RedissonApplicationTest       : 其他线程拿到锁啦
</span></span><span style=display:flex><span>2022-12-20 21:48:19.190  INFO 2587 --- [           main] c.t.l.test.RedissonApplicationTest       : 主线程拿到锁啦
</span></span></code></pre></div><h4 id=信号量>信号量</h4><p>基于Redis的Redisson的分布式信号量（Semaphore）Java对象RSemaphore采用了与java.util.concurrent.Semaphore相似的接口和用法。个人理解这个信号量有点像上文提到的限流器，执行 acquire 方法阻塞，直到有对应数量许可证可以获得然后拿走许可证，每个 release 方法增加若干个许可证。这个许可证和限流器的令牌，其实是很类似的。所以感觉也可以用信号量来实现限流器的功能。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedissonApplicationTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    RedissonClient redissonClient<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    ObjectMapper objectMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    Executor execute<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TestSemaphore</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 一共设置量5个信号量 子线程先获取3个
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        execute<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()-&gt;{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 需提前在redis中设置key为semaphore 值为对应信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            RSemaphore semaphore <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getSemaphore</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;semaphore&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;子线程可用的信号量：[{}]&#34;</span><span style=color:#f92672>,</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>availablePermits</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 两秒后释放
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>2000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        RSemaphore semaphore <span style=color:#f92672>=</span> redissonClient<span style=color:#f92672>.</span><span style=color:#a6e22e>getSemaphore</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;semaphore&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;主线程可用的信号量：[{}]&#34;</span><span style=color:#f92672>,</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>availablePermits</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 主线程获取不到对应数量的信号量 会阻塞
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;主线程获取到对应数量信号量啦&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>2022-12-25 16:59:41.013  INFO 10324 --- [         task-1] c.t.l.test.RedissonApplicationTest       : 子线程可用的信号量：[5]
</span></span><span style=display:flex><span>2022-12-25 16:59:42.024  INFO 10324 --- [           main] c.t.l.test.RedissonApplicationTest       : 主线程可用的信号量：[1]
</span></span><span style=display:flex><span>2022-12-25 16:59:43.233  INFO 10324 --- [           main] c.t.l.test.RedissonApplicationTest       : 主线程获取到对应数量信号量啦
</span></span></code></pre></div><h2 id=总结>总结</h2><p>记录了下自己使用Redission的过程，如果你也正在入门使用Redission，那希望这篇文章对你有所帮助。文章内容大部分参考官方文档，官方文档yyds，嘻嘻。
通过自己手敲几个入门使用的案例，谈谈一下我的个人感受吧，Redis作为中间件应用的存在，也就说明它能够被多个服务应用所共用数据。而Redission正是利用了这一点，它将Java的集合数据结构Map、List、Set等用Redis对应的数据结构Hash、List、Set进行封装。在使用上，这些封装的集合对象和普通的Java集合对象并没有什么区别。在具体的存储实现上，一个是存在于JVM的内存中，另一个则是存到了Redis上对应的数据结构上。由于数据都存在于Redis中，那么对于多个实例的应用来说，这些数据是共用的，在高并发场景下，配合分布式锁，可以很大程度避免高并发场景下的一系列并发问题的发生。只要你了解Redis的基本数据结构，以及Java的基本集合对象，上手Redisson还是很快的。Redission提供了分布式相关的对象，以便于我们处理分布式场景下的相关复杂的业务问题，工具也只是手段，遇到具体的业务问题或场景，分析业务场景使用合适的分布式对象或者集合，或许可以让问题变得简单起来。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/redis>redis</a>
<a href=/tags/redission>redission</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E5%9F%8E%E5%B8%82%E5%A4%A7%E6%A5%BC%E5%92%96%E5%95%A1%E5%8E%85%E6%97%A9%E8%B5%B7%E5%8D%88%E9%A4%90%E8%AF%B4%E6%99%9A%E5%AE%89/ rel=next title=城市大楼咖啡厅,早起午餐说晚安><i class="fa fa-chevron-left"></i> 城市大楼咖啡厅,早起午餐说晚安</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E5%85%B3%E4%BA%8Emaven%E7%9A%84%E5%A4%9A%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86/ rel=prev title=关于Maven的多模块管理>关于Maven的多模块管理
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-paper-plane"></i></span>
<span class=author itemprop=copyrightHolder>Teoan</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://teoan.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.5207e106e9f92dcba41e11e145b3dea597901a731ea853825859c3c82c35adf6.js defer></script></body></html>